<nav class="groups-nav">
	<section class="groups-nav-section">
		<div class="group-header input-group">
			<?php echo Form::open(array('route' => 'messages', 'class'=>'form navbar-form navbar-left searchform')); ?>

			    <?php echo Form::text('search', null, array('required',
			                                'class'=>'form-control',
			                                'placeholder'=>'Search')); ?>

			    <?php /* <?php echo Form::submit('Search', array('class'=>'btn btn-default')); ?> */ ?>
			<?php echo Form::close(); ?>

			<span class="input-group-btn">
				<a onclick="createMessage()" class="btn btn-default btn-xs pull-right"><span class="glyphicon glyphicon-plus" aria-hidden="true"></span></a>
			</span>
		</div>

		<div class="group-list">			
			<?php if(Session::has('error_message')): ?>
                <div class="alert alert-danger" role="alert">
                    <?php echo Session::get('error_message'); ?>

                </div>
            <?php endif; ?>
            <?php if($threads->count() > 0): ?>
                <?php foreach($threads as $thread): ?>
	                <?php $class = $thread->isUnread($currentUserId) ? 'alert-info' : ''; ?>
	                <div onclick="showMessage(<?php echo $thread->id; ?>)" data-pjax='#chat-area' class="media alert <?php echo $class; ?> clickable">
	                    <?php /* <h4 class="media-heading"><?php echo link_to('messages/' . $thread->id, $thread->subject); ?></h4> */ ?>
	                    <?php /* <a href="<?php echo 'messages/' . $thread->id; ?>"> </a> */ ?>
	                    <h4 class="media-heading"><?php echo $thread->participantsString(Auth::user()->id); ?></h4>
	                    <p>
	                    	<?php 
	                    		$latestUser = vRemind\User::find($thread->latestMessage->user_id); 
	                    		if ($latestUser->id == Auth::id())
	                    			$name = "You"; 
	                    		else
	                    			$name = $latestUser->name;
	                    	?>
	                    		
	                    	<?php if(strlen($thread->latestMessage->body) <= 40): ?>
	                    		<?php echo $name . ": " . $thread->latestMessage->body; ?>

                    		<?php else: ?>
	                    		<?php echo $name . ": " . substr($thread->latestMessage->body, 0, 40) . "..."; ?>

                    		<?php endif; ?>
	                    </p>
	                    <?php /* <p><small><strong>Creator:</strong> <?php echo $thread->creator()->name; ?></small></p>
	                    <p><small><strong>Participants:</strong> <?php echo $thread->participantsString(Auth::id()); ?></small></p> */ ?>
	                </div>
                <?php endforeach; ?>
            <?php else: ?>
                <p>Sorry, no threads.</p>
            <?php endif; ?>
		</div>
	</section>	
</nav>